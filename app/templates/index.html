<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Chat AI Moderna</title>
<style>
  /* Importa il font "Inter" da Google Fonts */
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');

  /* Stile generale del body: sfondo scuro, font moderno, centratura verticale e orizzontale */
  body {
    margin: 0;
    background: #121214;
    font-family: 'Inter', sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh; /* altezza viewport completa */
  }

  /* Contenitore principale della chat, con larghezza e altezza fisse, sfondo scuro, angoli arrotondati e ombra */
  .chat-container {
    width: 420px;
    max-width: 100vw; /* responsivo su schermi piccoli */
    height: 600px;
    background: #1E1E1E;
    border-radius: 15px;
    display: flex;
    flex-direction: column; /* elementi in colonna */
    box-shadow: 0 8px 24px rgba(0,0,0,0.4);
    overflow: hidden; /* nasconde overflow */
  }

  /* Intestazione della chat, colore di sfondo diverso e testo bianco centrato */
  .chat-header {
    background: #2E2E2E;
    padding: 18px 25px;
    font-weight: 700;
    font-size: 20px;
    color: #fff;
    text-align: center;
    letter-spacing: 0.05em;
    user-select: none; /* impedisce la selezione del testo */
  }

  /* Area dove appaiono i messaggi, scroll verticale se serve, flex colonna con spaziatura */
  .chat-messages {
    flex-grow: 1; /* prende tutto lo spazio verticale disponibile */
    padding: 20px;
    overflow-y: auto; /* scroll verticale automatico */
    background: #121214;
    display: flex;
    flex-direction: column;
    gap: 12px; /* spazio tra i messaggi */
  }

  /* Stile base messaggi: larghezza massima, padding, arrotondamenti, font leggibile e animazione comparsa */
  .message {
    max-width: 80%;
    padding: 12px 18px;
    border-radius: 20px;
    font-size: 15px;
    line-height: 1.4;
    word-wrap: break-word; /* testo va a capo se lungo */
    animation: fadeIn 0.3s ease forwards; /* animazione fadeIn */
  }

  /* Messaggi dell'utente: allineati a destra con sfondo azzurro sfumato e testo bianco */
  .message.user {
    align-self: flex-end; /* allineamento a destra */
    background: linear-gradient(135deg, #4e9af1, #2b6cd3);
    color: white;
    border-bottom-right-radius: 5px; /* bordo meno arrotondato in basso a destra */
  }

  /* Messaggi del bot: allineati a sinistra con sfondo grigio scuro e testo chiaro */
  .message.bot {
    align-self: flex-start; /* allineamento a sinistra */
    background: #2a2a2a;
    color: #ccc;
    border-bottom-left-radius: 5px; /* bordo meno arrotondato in basso a sinistra */
  }

  /* Barra di input della chat con sfondo scuro e padding */
  .chat-input {
    background: #2E2E2E;
    padding: 15px 20px;
    display: flex;
    gap: 12px; /* spazio tra input e bottone */
  }

  /* Input testo stile moderno, arrotondato, senza bordo e con transizioni */
  .chat-input input[type="text"] {
    flex-grow: 1; /* prende tutto lo spazio orizzontale possibile */
    padding: 14px 20px;
    border-radius: 25px;
    border: none;
    font-size: 16px;
    outline: none; /* rimuove bordo di focus standard */
    background: #121214;
    color: white;
    transition: background-color 0.2s ease;
  }

  /* Cambia colore di sfondo dell'input quando è attivo (focus) */
  .chat-input input[type="text"]:focus {
    background: #232323;
  }

  /* Bottone invio stile arrotondato, azzurro, con transizione su hover */
  .chat-input button {
    background: #4e9af1;
    border: none;
    border-radius: 25px;
    padding: 0 25px;
    color: white;
    font-weight: 600;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.25s ease;
  }

  /* Colore del bottone più scuro quando ci si passa sopra con il mouse */
  .chat-input button:hover {
    background: #2b6cd3;
  }

  /* Animazione fadeIn usata dai messaggi: partono invisibili e scendono leggermente */
  @keyframes fadeIn {
    from {opacity: 0; transform: translateY(8px);}
    to {opacity: 1; transform: translateY(0);}
  }

  /* Stile scrollbar verticale minimale nella finestra messaggi */
  .chat-messages::-webkit-scrollbar {
    width: 6px;
  }
  .chat-messages::-webkit-scrollbar-thumb {
    background: #444;
    border-radius: 3px;
  }
</style>
</head>
<body>
  <!-- Contenitore principale della chat -->
  <div class="chat-container">
    <!-- Intestazione con il titolo -->
    <div class="chat-header">Chat AI Moderna</div>
    <!-- Area dove verranno mostrati i messaggi -->
    <div id="chatMessages" class="chat-messages"></div>
    <!-- Form per inserire il messaggio e inviarlo -->
    <form id="chatForm" class="chat-input" onsubmit="event.preventDefault(); sendMessage();">
      <!-- Input testo per scrivere il messaggio -->
      <input type="text" id="message" placeholder="Scrivi un messaggio..." autocomplete="off" required />
      <!-- Bottone per inviare -->
      <button type="submit">Invia</button>
    </form>
  </div>

<script>
  // Riferimenti agli elementi del DOM
  const chatMessages = document.getElementById('chatMessages');
  const input = document.getElementById('message');
  const form = document.getElementById('chatForm');

  // Funzione per aggiungere un messaggio nella chat
  // text = testo del messaggio, sender = "user" o "bot" per la classe CSS
  function addMessage(text, sender) {
    const div = document.createElement('div'); // crea un nuovo div
    div.classList.add('message', sender);       // aggiunge le classi CSS appropriate
    div.textContent = text;                      // imposta il testo del messaggio
    chatMessages.appendChild(div);               // aggiunge il messaggio nella finestra chat
    chatMessages.scrollTop = chatMessages.scrollHeight; // scrolla fino in fondo
  }

  // Funzione asincrona per inviare il messaggio al server e ricevere risposta
  async function sendMessage() {
    const msg = input.value.trim(); // prendi il testo e togli spazi ai lati
    if (!msg) return;               // se vuoto esci
    addMessage(msg, 'user');        // mostra messaggio utente in chat
    input.value = '';               // pulisci input
    input.disabled = true;          // disabilita input mentre aspetti risposta

    try {
      // Invio richiesta POST a /chat con il messaggio utente in JSON
      const response = await fetch('/chat', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({message: msg})
      });
      const data = await response.json(); // prendo la risposta JSON dal server
      addMessage(data.response, 'bot');   // aggiungo la risposta del bot in chat
      speak(data.response);                // faccio parlare il bot col text-to-speech
    } catch {
      addMessage('Errore di connessione, riprova.', 'bot'); // messaggio errore
    } finally {
      input.disabled = false; // riabilito l'input
      input.focus();          // metto il focus di nuovo nell'input
    }
  }

  // Funzione per far parlare il testo usando la sintesi vocale del browser
  function speak(text) {
    if ('speechSynthesis' in window) {           // se supportato
      const utterance = new SpeechSynthesisUtterance(text);
      window.speechSynthesis.speak(utterance);   // parla il testo
    }
  }

  // Imposta il focus sull'input appena carica la pagina
  input.focus();
</script>
</body>
</html>
